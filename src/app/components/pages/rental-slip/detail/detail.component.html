<!-- ↓ パンくずリスト ↓ -->
<app-breadcrumb-org
  [breadcrumbList]="[
    { path: listPagePath, text: 'レンタル受付票一覧' },
    { text: 'レンタル受付票詳細' }
  ]">
</app-breadcrumb-org>
<main class="mb-8">
  <h1 class="mt-8 text-xl">レンタル受付票詳細</h1>
  <div class="mt-6 mb-2 flex flex-row items-center justify-between">
    <div class="flex flex-row items-center gap-6">
      <app-back-to-link-org [path]="listPagePath"
        >一覧へ戻る</app-back-to-link-org
      >
      <app-edit-link-org [path]="editPagePath"> </app-edit-link-org>
    </div>
    <app-last-updater-org>
      最終更新者：{{ updaterFullName ? updaterFullName : 'データ取得中...' }}
    </app-last-updater-org>
  </div>
  <hr class="width-limit-break border-t border-gray-400" />
  <ng-container *ngIf="rs; else duringAcquisition">
    <div class="mt-8">
      <div class="flex justify-between">
        <div class="w-3/5">
          <form
            class="text-base"
            [formGroup]="statusForm"
            (submit)="statusUpdate()">
            <div class="flex gap-4">
              <div class="w-1/5">
                <app-select-container
                  nameAttrValue="status_division_id"
                  idAttrValue="status_division_id"
                  [formCtrl]="statusFc.status_division_id"
                  [options]="statusDivisionOptions"
                  [invalid]="
                    formControlStateManager(statusFc.status_division_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: 'ステータス', required: false }
                    "></ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { ctrl: statusFc.status_division_id }
                    "
                    message></ng-container>
                </app-select-container>
              </div>
              <div class="w-1/5">
                <app-select-container
                  nameAttrValue="reception_employee_id"
                  idAttrValue="reception-employee-id"
                  [formCtrl]="statusFc.reception_employee_id"
                  placeholder="選択してください"
                  [options]="employeeSuggests">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '受付担当者', required: 'true' }
                    "></ng-container>
                </app-select-container>
              </div>
              <div class="w-1/5">
                <app-text-container
                  nameAttrValue="reception_tag"
                  idAttrValue="reception-tag"
                  [formCtrl]="statusFc.reception_tag">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: {
                        label: '受付タグ',
                        required: reception_tag_require
                      }
                    ">
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/5">
                <!-- 処理単位選択 -->
                <app-select-container
                  nameAttrValue="processing_units"
                  idAttrValue="processing-units"
                  [formCtrl]="statusFc.processing_units"
                  [options]="processingUnits"
                  placeholder="選択してください"
                  [invalid]="
                    formControlStateManager(statusFc.processing_units)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '処理単位', required: 'true' }
                    "></ng-container>
                </app-select-container>
              </div>
              <div class="mt-6 w-1/5">
                <app-button
                  btnType="submit"
                  btnFillColor="bg-success"
                  btnHoverColor="hover:bg-success-hover"
                  btnTextColor="text-white"
                  btnLineColor="border-success"
                  btnLineHoverColor="hover:border-success-hover"
                  [buttonDisabled]="statusForm.invalid || statusForm.pristine">
                  更新
                </app-button>
              </div>
            </div>
          </form>
        </div>
        <div
          *ngIf="isDelivery && deliveries.length < 1"
          class="flex gap-6 mt-6 items-center">
          <div>
            <app-button (click)="toRegisterDeliverySchedulePage()"
              >配送を登録</app-button
            >
          </div>
        </div>
      </div>
    </div>
    <div class="mt-4 mb-24 py-8 px-6 bg-white shadow border border-gray-300">
      <div class="relative">
        <div
          class="absolute left-[-20px] top-[-28px] bg-primary-hover px-4 py-1 rounded-full text-white">
          {{ rs.division_status_value }}
        </div>
        <div class="absolute right-0">
          <ng-container *ngIf="!rs.processing_units">
            <ng-container *ngIf="!disabledRentalTodayButton()">
              <p>受付票番号：{{ rs.id }}</p>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="rs.processing_units?.toString() === '1'">
            <ng-container *ngIf="!detailUnitdisabledRentalTodayButton()">
              <p>受付票番号：{{ rs.id }}</p>
            </ng-container>
          </ng-container>
        </div>
      </div>
      <!-- タイトル -->
      <div class="flex justify-center">
        <h2 class="text-center text-2xl border-b border-slate-500">
          レンタル受付票
        </h2>
      </div>
      <!-- お客様情報・会社情報 -->
      <div class="flex justify-between mt-2">
        <div class="w-1/3">
          <p>お客様タイプ：{{ rs.division_customer_type_value }}</p>
          <!-- お客様タイプ：得意先の場合 -->
          <ng-container
            *ngIf="
              rs.division_customer_type_value ===
                rsConst.CUSTOMER_TYPE_DIVISION.VALUE.CLIENT;
              then client
            "></ng-container>
          <!-- お客様タイプ：会員の場合 -->
          <ng-container
            *ngIf="
              rs.division_customer_type_value ===
                rsConst.CUSTOMER_TYPE_DIVISION.VALUE.MEMBER;
              then member
            "></ng-container>
          <!-- お客様タイプ：一般の場合 -->
          <ng-container
            *ngIf="
              rs.division_customer_type_value ===
                rsConst.CUSTOMER_TYPE_DIVISION.VALUE.GENERAL;
              then general
            "></ng-container>
        </div>
        <div>
          <!-- 清算バーコード-->
          <ng-container
            *ngIf="
              rs.division_customer_type_code?.toString() ===
              DIVISION_CUSTOMER_CODE_GENERAL
            ">
            <ng-container *ngIf="!rs.processing_units">
              <ng-container *ngIf="!disabledRentalTodayButton()">
                <app-barcode
                  elementId="barcode"
                  [value]="barcodeValue"></app-barcode>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="rs.processing_units?.toString() === '1'">
              <ng-container
                *ngIf="!detailUnitdisabledRentalTodayButtonBarcode()">
                <app-barcode
                  elementId="barcode"
                  [value]="barcodeValue"></app-barcode>
              </ng-container>
            </ng-container>
          </ng-container>
          <ng-container
            *ngIf="
              rs.division_customer_type_code?.toString() ===
              DIVISION_CUSTOMER_CODE_MEMBER
            ">
            <ng-container *ngIf="!disabledRentalTodayButton()">
              <app-barcode
                elementId="barcode"
                [value]="barcodeValue"></app-barcode>
            </ng-container>
          </ng-container>
          <ng-container
            *ngIf="
              rs.division_customer_type_code?.toString() ===
              DIVISION_CUSTOMER_CODE_CLIENT
            ">
            <ng-container
              *ngIf="
                this.selectedCustomerStatus.rental_employee_id &&
                this.selectedCustomerStatus.reception_tag
              ">
              <app-barcode
                elementId="barcode"
                [value]="barcodeValue"></app-barcode>
            </ng-container>
          </ng-container>
        </div>
        <div class="w-1/3">
          <p>受付日時：{{ receptionDate }}</p>
          <ng-container *ngIf="basicInformation && rs">
            <p class="text-2xl text-center mt-2">{{ basicInformation.name }}</p>
            <p class="text-center mb-2">金物・建設・農園資材の専門店</p>
            <p>TEL : {{ companyTel }}　FAX : {{ companyFax }}</p>
            <p>〒{{ companyPostalCode }} {{ companyAddress }}</p>
            <p class="mt-2">
              代表取締役　{{ basicInformation.representative_name }}
            </p>
            <p>担当：{{ receptionEmployeeFullName }}</p>
          </ng-container>
        </div>
      </div>
      <!-- Start 処理単位: 受付表単位 -->
      <form [formGroup]="bulkForm">
        <ng-container *ngIf="!is_processing_units">
          <div class="mt-4 mx-4 flex gap-6">
            <ng-container *ngIf="!rentalItemStatus">
              <div class="w-1/3 flex">
                <app-select-container
                  class="w-2/3"
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="bulkFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(bulkFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: bulkFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-1/3"
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/3 mt-6">
                <app-button
                  class="ml-2 mr-2"
                  btnType="submit"
                  btnFillColor="bg-success"
                  btnHoverColor="hover:bg-success-hover"
                  btnTextColor="text-white"
                  btnLineColor="border-success"
                  btnLineHoverColor="hover:border-success-hover"
                  (click)="rentalToday()"
                  [buttonDisabled]="disabledRentalTodayButton()"
                  >貸出（当日）</app-button
                >
              </div>
              <div class="w-1/3"></div>
            </ng-container>
            <!-- Start 受付票単位(表示) -->
            <ng-container *ngIf="rentalItemStatus">
              <div class="w-1/3 flex">
                <app-select-container
                  class="w-3/5"
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="bulkFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(bulkFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: bulkFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
                &nbsp;
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-2/5"
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/3 flex">
                <app-select-container
                  class="w-3/5"
                  nameAttrValue="return_employee_id"
                  idAttrValue="return-employee-id"
                  [formCtrl]="bulkFc.return_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(bulkFc.return_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '返却担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: bulkFc.return_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
                &nbsp;
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-2/5"
                  nameAttrValue="get_return_employee_id"
                  idAttrValue="get-return-employee-id"
                  [formCtrl]="getEmployeeByIdFcReturn.get_return_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcReturn.get_return_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcReturn.get_return_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/6">
                <app-select-container
                  nameAttrValue="late_return_reported"
                  idAttrValue="late-return-reported"
                  [formCtrl]="bulkFc.late_return_reported"
                  [options]="lateReturnReportedOptions"
                  [invalid]="
                    formControlStateManager(bulkFc.late_return_reported)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '延滞報告', required: 'true' }
                    "></ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { ctrl: bulkFc.late_return_reported }
                    "
                    message></ng-container>
                </app-select-container>
              </div>
              <div class="w-1/6"></div>
            </ng-container>
            <!-- End 受付票単位(表示) -->
          </div>
        </ng-container>
        <ng-container *ngIf="!is_processing_units">
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-1/3">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_rental_date"
                    idAttrValue="scheduled-rental-date"
                    [formCtrl]="
                      bulkFc.scheduledDateGroup.controls.scheduled_rental_date
                    "
                    [invalid]="formControlStateManager(bulkFc.scheduledDateGroup.controls.scheduled_rental_date) || bulkFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: bulkFc.scheduledDateGroup.controls
                            .scheduled_rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_return_date"
                    idAttrValue="scheduled-return-date"
                    [formCtrl]="
                      bulkFc.scheduledDateGroup.controls.scheduled_return_date
                    "
                    [invalid]="formControlStateManager(bulkFc.scheduledDateGroup.controls.scheduled_return_date) || bulkFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '返却予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: bulkFc.scheduledDateGroup.controls
                            .scheduled_return_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: bulkFc.scheduledDateGroup }
                "></ng-container>
            </div>
            <div class="w-1/3">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="rental_date"
                    idAttrValue="rental-date"
                    [formCtrl]="bulkFc.dateGroup.controls.rental_date"
                    [invalid]="formControlStateManager(bulkFc.dateGroup.controls.rental_date) || bulkFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出日', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: bulkFc.dateGroup.controls.rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <ng-container *ngIf="rentalItemStatus">
                  <div class="w-1/2">
                    <app-date-term
                      nameAttrValue="return_date"
                      idAttrValue="return-date"
                      [formCtrl]="bulkFc.dateGroup.controls.return_date"
                      [invalid]="formControlStateManager(bulkFc.dateGroup.controls.return_date) || bulkFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                      <ng-container
                        *ngTemplateOutlet="
                          labels;
                          context: { label: '返却日', required: false }
                        ">
                      </ng-container>
                      <ng-container
                        *ngTemplateOutlet="
                          errors;
                          context: {
                            ctrl: bulkFc.dateGroup.controls.return_date
                          }
                        "
                        message>
                      </ng-container>
                    </app-date-term>
                  </div>
                </ng-container>
                <ng-container *ngIf="!rentalItemStatus">
                  <div class="w-1/2"></div>
                </ng-container>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: bulkFc.dateGroup }
                "></ng-container>
            </div>
            <div class="w-1/3 flex">
              <ng-container *ngIf="!boolean_return_date && boolean_rental_date">
                <div class="mt-6">
                  <app-button
                    class="mr-2"
                    btnType="submit"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    (click)="returnToday()"
                    [buttonDisabled]="disabledReturnTodayButton()"
                    >返却（当日）</app-button
                  >
                </div>
              </ng-container>
              <div
                class="flex flex-row justify-center bottom-[40px] edit_save_buttom">
                <app-button
                  (click)="onClickBulkFormReset()"
                  class="ml-2 mr-2 mt-6"
                  >クリア</app-button
                >
                <ng-container
                  *ngIf="!boolean_return_date && !boolean_rental_date">
                  <!--貸出保存ボタン-->
                  <app-button
                    class="ml-2 mr-2 mt-6"
                    btnType="submit"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    (click)="rentalDateBulkSave()"
                    [buttonDisabled]="disabledBulkRentalSaveButton()"
                    >保存</app-button
                  >
                </ng-container>
                <ng-container
                  *ngIf="!boolean_return_date && boolean_rental_date">
                  <!--返却保存ボタン-->
                  <app-button
                    class="ml-2 mr-2 mt-6"
                    btnType="submit"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    (click)="bulkSave()"
                    [buttonDisabled]="disabledBulkSaveButton()"
                    >保存</app-button
                  >
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>
      </form>
      <!-- End 処理単位: 受付表単位 -->
      <div>
        <!-- 受付票に紐付く配送情報 -->
        <app-delivery-table-org
          [deliveries]="deliveries"></app-delivery-table-org>
        <!-- 受付票に紐付くレンタル商品情報 -->
        <ng-container *ngIf="rentals">
          <table
            class="mt-6 w-[100%] table-fixed border-collapse border border-slate-500">
            <thead class="text-sm">
              <th class="border border-slate-300 w-[64px]">
                <div>
                  <p>ID</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[64px]">
                <div>
                  <p>商品ID</p>
                </div>
              </th>
              <th class="border border-slate-300">
                <div>
                  <p>品名</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[64px]">
                <div>
                  <p>数量</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[180px]">
                <div>
                  <p>料金（税込）</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>配送区分</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>回収区分</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>貸出予定日</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>貸出日</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>返却予定日</p>
                </div>
              </th>
              <th class="border border-slate-300 w-[80px]">
                <div>
                  <p>返却日</p>
                </div>
              </th>
              <td class="border border-slate-300 w-[64px]">
                <div class="text-center">
                  <p>清算</p>
                </div>
              </td>
              <ng-container>
                <th class="border border-slate-300 w-[100px]">
                  <div>
                    <p>操作</p>
                  </div>
                </th>
              </ng-container>
            </thead>
            <tbody class="text-sm">
              <ng-container *ngIf="rentals.length > 0">
                <ng-container *ngFor="let rental of rentals">
                  <tr
                    [ngClass]="{
                      'bg-slate-100': editTarget && editTarget.id === rental.id
                    }">
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>{{ rental.id }}</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>{{ rental.rental_product_id }}</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div>
                        <p>{{ rental.rental_product_name }}</p>
                        <p class="text-xs mt-1">
                          {{
                            rental.remarks_1 ? '備考1: ' + rental.remarks_1 : ''
                          }}
                        </p>
                        <p class="text-xs mt-1">
                          {{
                            rental.remarks_2 ? '備考2: ' + rental.remarks_2 : ''
                          }}
                        </p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>{{ rental.rental_item_count }}</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-right">
                        <p>{{ rental.rental_fee.toLocaleString() }} 円</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>{{ rental.division_delivery_value }}</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>{{ rental.division_collection_value }}</p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>
                          {{ rental.scheduled_rental_date }}
                        </p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>
                          {{ rental.rental_date }}
                        </p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>
                          {{ rental.scheduled_return_date }}
                        </p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        <p>
                          {{ rental.return_date }}
                        </p>
                      </div>
                    </td>
                    <td class="border border-slate-300 px-1">
                      <div class="text-center">
                        {{ rental.division_settle_status_value }}
                      </div>
                    </td>
                    <ng-container>
                      <td class="border border-slate-300 px-1">
                        <div class="flex justify-around">
                          <ng-container *ngIf="is_processing_units">
                            <!-- 処理単位が 受付票単位時は非アクティブ -->
                            <ng-container
                              *ngIf="!addFormIsOpen; else inoperableEditIcon">
                              <div class="cursor-pointer">
                                <app-icon-container
                                  (click)="editFormOpen(rental)"
                                  appendClassForIcon="fill-warning group-hover:fill-warning-hover"
                                  icon="edit-2-line">
                                </app-icon-container>
                              </div>
                            </ng-container>
                          </ng-container>
                          <ng-container
                            *ngIf="
                              !addFormIsOpen && !editFormIsOpen;
                              else inoperableDeleteIcon
                            ">
                            <div class="cursor-pointer">
                              <!--貸出中は非表示-->
                              <ng-container *ngIf="!rental.rental_date">
                                <app-icon-container
                                  (click)="deleteRental(rental.id)"
                                  icon="delete-bin-line"
                                  appendClassForIcon="cursor-pointer fill-danger group-hover:fill-danger-hover">
                                </app-icon-container>
                              </ng-container>
                            </div>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>
                  </tr>
                  <ng-container>
                    <tr
                      *ngIf="
                        !addFormIsOpen &&
                        editFormIsOpen &&
                        editTarget.id === rental.id
                      ">
                      <td colspan="11" class="border border-slate-300">
                        <div class="bg-slate-100">
                          <ng-container
                            *ngIf="
                              !addFormIsOpen &&
                                editFormIsOpen &&
                                editTarget.id === rental.id;
                              then edit
                            "></ng-container>
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
                <tr>
                  <td colspan="11" class="border border-slate-300">
                    <div class="text-right pr-2 py-2 text-sm">
                      合計金額（税込）
                      <span class="text-base font-bold">{{
                        totalAmount ? totalAmount.toLocaleString() : ''
                      }}</span>
                      円
                    </div>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </ng-container>
      </div>

      <div class="w-ful">
        <!-- 受付票に紐付くレンタル商品情報 -->
        <ng-container *ngIf="set_overdue_rentals">
          <!-- Start 延滞・差額分のコントロール  -->
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-full">差額処理</div>
          </div>
          <ng-container *ngIf="!is_processing_units">
            <div class="mt-4 mx-4 flex gap-6">
              <div class="w-1/3 flex">
                <app-select-container
                  class="w-3/5"
                  nameAttrValue="return_employee_id"
                  idAttrValue="return-employee-id"
                  [formCtrl]="diffFc.return_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(diffFc.return_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '受領担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: diffFc.return_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
                &nbsp;
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-2/5"
                  nameAttrValue="get_return_employee_id"
                  idAttrValue="get-return-employee-id"
                  [formCtrl]="getEmployeeByIdFcDiff.get_return_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcDiff.get_return_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcDiff.get_return_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/6">
                <app-date-term
                  nameAttrValue="return_date"
                  idAttrValue="return-date"
                  [formCtrl]="diffFc.dateGroup.controls.return_date"
                  [invalid]="formControlStateManager(diffFc.dateGroup.controls.return_date) || diffFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '受領・返金日', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        ctrl: diffFc.dateGroup.controls.return_date
                      }
                    "
                    message>
                  </ng-container>
                </app-date-term>
              </div>
              <div class="w-1/6"></div>
              <div class="w-1/3 flex">
                <ng-container *ngIf="!boolean_receipt_date">
                  <div class="w-2/5 mt-6 ml-2">
                    <app-button
                      btnType="submit"
                      btnFillColor="bg-success"
                      btnHoverColor="hover:bg-success-hover"
                      btnTextColor="text-white"
                      btnLineColor="border-success"
                      btnLineHoverColor="hover:border-success-hover"
                      (click)="receiptToday()"
                      >受領（当日）</app-button
                    >
                  </div>
                </ng-container>
                <div
                  class="flex flex-row justify-center bottom-[40px] edit_save_buttom">
                  <app-button
                    (click)="onClickDiffFormReset()"
                    class="ml-2 mr-2 mt-6"
                    >クリア</app-button
                  >
                  <app-button
                    class="ml-2 mr-2 mt-6"
                    btnType="submit"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    (click)="handleClickDiffSaveButton('')"
                    >保存</app-button
                  >
                </div>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="diffrecords.length > 0">
            <div class="mt- mx-4 flex gap-6">
              <div class="w-1/4"></div>
              <div class="w-2/4">
                {{ refund_msg }}
              </div>
              <div class="w-1/4"></div>
            </div>
          </ng-container>
          <!-- Start 延滞・差額分のコントロール  -->
          <div class="flex justify-end">
            <table
              class="mt-6 w-[100%] table-fixed border-collapse border border-slate-500">
              <thead class="text-sm">
                <th class="border border-slate-300 w-[64px]">
                  <div>
                    <p>対象ID</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[64px]">
                  <div>
                    <p>商品ID</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[64px]">
                  <div>
                    <p>ステータス</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[180px]">
                  <div>
                    <p>品名</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>数量</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[180px]">
                  <div>
                    <p>差額（延滞・払戻）（税込）</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>-</p>
                  </div>
                </th>
                <!--<th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>-</p>
                  </div>
                </th>-->
                <th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>貸出日</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>返却予定日</p>
                  </div>
                </th>
                <th class="border border-slate-300 w-[80px]">
                  <div>
                    <p>受領・返金日</p>
                  </div>
                </th>
                <td class="border border-slate-300 w-[64px]">
                  <div class="text-center">
                    <p>清算</p>
                  </div>
                </td>
                <ng-container>
                  <th class="border border-slate-300 w-[100px]">
                    <div>
                      <p>操作</p>
                    </div>
                  </th>
                </ng-container>
              </thead>
              <tbody class="text-sm">
                <ng-container *ngIf="overdue_rentals.length > 0">
                  <ng-container
                    *ngFor="let overdue of overdue_rentals; index as i">
                    <tr
                      [ngClass]="{
                        'bg-slate-100':
                          editTarget && editTarget.id === overdue.id
                      }">
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>{{ overdue.parent_id }}</p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>{{ overdue.rental_product_id }}</p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>{{ overdue.overdue_rentals_status_name }}</p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div>
                          <p>{{ overdue.rental_product_name }}</p>
                          <p class="text-xs mt-1">
                            {{
                              overdue.remarks_1
                                ? '備考1: ' + overdue.remarks_1
                                : ''
                            }}
                          </p>
                          <p class="text-xs mt-1">
                            {{
                              overdue.remarks_2
                                ? '備考2: ' + overdue.remarks_2
                                : ''
                            }}
                          </p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>{{ overdue.rental_item_count }}</p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-right">
                          <p>
                            {{
                              overdue.rental_fee
                                ? overdue.rental_fee.toLocaleString()
                                : ''
                            }}
                            円
                          </p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>-</p>
                        </div>
                      </td>
                      <!--<td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>-</p>
                        </div>
                      </td>-->
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>
                            {{ overdue.rental_date }}
                          </p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>
                            {{ overdue.scheduled_return_date }}
                          </p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          <p>
                            {{ overdue.return_date }}
                          </p>
                        </div>
                      </td>
                      <td class="border border-slate-300 px-1">
                        <div class="text-center">
                          {{ overdue.division_settle_status_value }}
                        </div>
                      </td>
                      <ng-container>
                        <td class="border border-slate-300 px-1">
                          <div class="flex justify-around">
                            <ng-container *ngIf="is_processing_units">
                              <!-- 処理単位が 受付票単位時は非アクティブ -->
                              <ng-container
                                *ngIf="!addFormIsOpen; else inoperableEditIcon">
                                <div class="cursor-pointer">
                                  <app-icon-container
                                    (click)="editFormOpen(overdue)"
                                    appendClassForIcon="fill-warning group-hover:fill-warning-hover"
                                    icon="edit-2-line">
                                  </app-icon-container>
                                </div>
                              </ng-container>
                            </ng-container>
                            <ng-container
                              *ngIf="
                                !addFormIsOpen && !editFormIsOpen;
                                else inoperableDeleteIcon
                              ">
                              <div class="cursor-pointer">
                                <app-icon-container
                                  (click)="deleteRental(overdue.id)"
                                  icon="delete-bin-line"
                                  appendClassForIcon="cursor-pointer fill-danger group-hover:fill-danger-hover">
                                </app-icon-container>
                              </div>
                            </ng-container>
                          </div>
                        </td>
                      </ng-container>
                    </tr>
                    <ng-container>
                      <tr
                        *ngIf="
                          !addFormIsOpen &&
                          editFormIsOpen &&
                          editTarget.id === overdue.id
                        ">
                        <td colspan="11" class="border border-slate-300">
                          <div class="bg-slate-100">
                            <ng-container
                              *ngIf="
                                !addFormIsOpen &&
                                  editFormIsOpen &&
                                  editTarget.id === overdue.id;
                                then receipt
                              "></ng-container>
                          </div>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="overdue_totalAmount">
                    <tr>
                      <td colspan="11" class="border border-slate-300">
                        <div class="text-right pr-2 py-2 text-sm">
                          合計金額 ( 延滞 )
                          <span class="text-base font-bold"
                            >{{ overdue_totalAmount.toLocaleString() }}
                          </span>
                          円
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                  <ng-container *ngIf="overdue_refund_totalAmount">
                    <tr>
                      <td colspan="11" class="border border-slate-300">
                        <div class="text-right pr-2 py-2 text-sm">
                          合計金額 ( 払戻 )
                          <span class="text-base font-bold"
                            >{{ overdue_refund_totalAmount.toLocaleString() }}
                          </span>
                          円
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
              </tbody>
            </table>
          </div>
        </ng-container>
      </div>
    </div>
  </ng-container>
</main>
<!-- データ取得中に表示するテンプレート -->
<ng-template #duringAcquisition>
  <p class="text-3xl text-center text-slate-500 mt-6">データ取得中...</p>
</ng-template>
<!-- お客様タイプが得意先の場合のテンプレート -->
<ng-template #client>
  <!-- 得意先ID -->
  <div>
    <p>{{ rs.client_id }}</p>
    <p class="mt-1">
      <span class="text-lg border-b border-slate-500"
        >{{ rs.client_name }} {{ rs.client_division_title_value }}</span
      >
    </p>
  </div>
</ng-template>

<!-- お客様タイプが会員の場合のテンプレート -->
<ng-template #member>
  <!-- 会員姓名 -->
  <div class="mt-2">
    <ruby>
      <span class="text-2xl">{{ rs.member_last_name }}</span>
      <rp>(</rp>
      <rt>{{ rs.member_last_name_kana }}</rt>
      <rp>)</rp>
    </ruby>
    <span>&nbsp;</span>
    <ruby>
      <span class="text-2xl">{{ rs.member_first_name }}</span>
      <rp>(</rp>
      <rt>{{ rs.member_first_name_kana }}</rt>
      <rp>)</rp>
    </ruby>
    <span class="text-2xl">　様</span>
  </div>
</ng-template>
<!-- お客様タイプが会員の場合のテンプレート -->
<ng-template #general>
  <!-- 会員姓名 -->
  <div class="mt-2">
    <ruby>
      <span class="text-2xl">{{ rs.last_name }}</span>
      <rp>(</rp>
      <rt>{{ rs.last_name_kana }}</rt>
      <rp>)</rp>
    </ruby>
    <span>&nbsp;</span>
    <ruby>
      <span class="text-2xl">{{ rs.first_name }}</span>
      <rp>(</rp>
      <rt>{{ rs.first_name_kana }}</rt>
      <rp>)</rp>
    </ruby>
    <span class="text-2xl">　様</span>
    <p>住所：{{ rs.shipping_address }}</p>
    <p>TEL：{{ rs.tel }}</p>
    <ng-container *ngIf="rs.mobile_number">
      <p>MOBILE：:{{ rs.mobile_number }}</p>
    </ng-container>
    <div>
      <ng-container
        *ngIf="
          selectedCustomer.type.toString() === DIVISION_CUSTOMER_CODE_GENERAL;
          else idConfirmed
        ">
        <div class="1/4 mt-3">
          <div class="mt-4">
            <ng-container *ngIf="!selectedCustomer.isIdConfirmationRequired">
              <span class="text-danger font-semibold"
                >（本人確認書類の確認が必要です！）</span
              >
            </ng-container>
          </div>
          <app-checkbox
            [formCtrl]="generalFc.idConfirmationDate_check"
            [invalid]="
              CheckBoxControlStateManager(generalFc.idConfirmationDate_check)
            "
            (change)="onCheckId($event)">
            <ng-container
              *ngTemplateOutlet="
                labels;
                context: {
                  label: '本人確認書類を確認しました',
                  required: false
                }
              "></ng-container>
            <ng-container
              *ngTemplateOutlet="
                errors;
                context: { ctrl: generalFc.idConfirmationDate_check }
              "
              message></ng-container>
          </app-checkbox>
        </div>
      </ng-container>
      <ng-template #idConfirmed>
        <p>前回本人確認書類確認日：{{ selectedCustomer.idConfirmationDate }}</p>
      </ng-template>
    </div>
  </div>
</ng-template>

<!-- 編集アイコンのテンプレート（操作不可） -->
<ng-template #inoperableEditIcon>
  <div>
    <app-icon-container
      appendClassForIcon="fill-slate-200"
      icon="edit-2-line"></app-icon-container>
  </div>
</ng-template>

<!-- 削除アイコンのテンプレート（操作不可） -->
<ng-template #inoperableDeleteIcon>
  <div>
    <app-icon-container
      icon="delete-bin-line"
      appendClassForIcon="fill-slate-200"></app-icon-container>
  </div>
</ng-template>

<!-- 追加フォームのテンプレート -->
<ng-template #add>
  <div class="mt-6 py-4 bg-slate-100 text-base">
    <div class="mx-4">
      <form
        class="mt-4"
        [formGroup]="addForm"
        (ngSubmit)="handleClickRentalAddExecutionButton()"
        (keydown.enter)="$event.preventDefault()"
        autocomplete="off">
        <p class="mx-4">
          追加する商品を選択してください（レンタル可能な商品のみ選択できます）
        </p>
        <div class="mx-4 mt-4 flex gap-6">
          <div class="w-2/4">
            <app-search-suggest-container
              nameAttrValue="name"
              idAttrValue="name"
              targetOptionData="text"
              [fc]="addFc.name"
              [apiInput]="getAddFormProductNameSuggests()"
              (idValueChanges)="onNameSuggestIdChange($event)"
              (selectedData)="onNameSuggestDataSelected($event)"
              [invalid]="formControlStateManager(addFc.name)">
              <div class="flex items-center gap-2">
                <span class="text-sm">商品名で検索</span>
              </div>
            </app-search-suggest-container>
          </div>
          <div class="w-2/4">
            <app-search-suggest-container
              nameAttrValue="id"
              idAttrValue="id"
              targetOptionData="value"
              [fc]="addFc.id"
              [apiInput]="getAddFormProductIdSuggests()"
              (idValueChanges)="onIdSuggestIdChange($event)"
              (selectedData)="onIdSuggestDataSelected($event)"
              [invalid]="formControlStateManager(addFc.id)">
              <div class="flex items-center gap-2">
                <span class="text-sm">商品IDで検索</span>
              </div>
            </app-search-suggest-container>
          </div>
        </div>
        <ng-container *ngIf="addFc.rental_product_id.value">
          <div class="mx-4 mt-4 flex gap-6">
            <p>選択中商品</p>
            ID：{{ addTargetProduct.id }}　商品名：{{ addTargetProduct.name }}
          </div>
        </ng-container>
        <div class="mx-4 mt-4 flex gap-6">
          <!-- <ng-container
            *ngIf="
              selectedProductDeliveryChargeFlag === 0;
              else addFormDeliveryCharge
            ">
            <div class="w-1/4">
              <span class="text-sm pl-1 mb-1"
                >選択中商品のレンタル料金{{
                  taxDivisionText ? '（' + taxDivisionText + '）' : ''
                }}</span
              >
              <div
                class="px-4 py-[8.5px] border border-slate-300 bg-slate-50 rounded-[4px] text-right text-base cursor-not-allowed">
                <p class="max-h-[22px]">
                  {{ selectedProductPrice.toLocaleString() }} 円
                </p>
              </div>
            </div>
          </ng-container> -->
          <ng-template #addFormDeliveryCharge>
            <div class="w-1/4">
              <app-text-container
                nameAttrValue="rental_fee"
                idAttrValue="rental-fee"
                [textRight]="true"
                [formCtrl]="addFc.rental_fee"
                [invalid]="formControlStateManager(addFc.rental_fee)">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '配送料（税込）', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: addFc.rental_fee }
                  "
                  message></ng-container>
              </app-text-container>
            </div>
          </ng-template>
        </div>
        <!-- 商品が選択されていない場合非表示 -->
        <ng-container *ngIf="addFc.rental_product_id.value">
          <!-- 選択された商品が配送料以外の場合 -->
          <ng-container *ngIf="!selectedProductDeliveryChargeFlag">
            <div class="mt-4 mx-4 flex gap-6">
              <div class="w-2/4">
                <div class="flex gap-6">
                  <div class="w-1/2">
                    <app-date-term
                      nameAttrValue="scheduled_rental_date"
                      idAttrValue="scheduled-rental-date"
                      [formCtrl]="
                        addFc.scheduledDateGroup.controls.scheduled_rental_date
                      "
                      [invalid]="formControlStateManager(addFc.scheduledDateGroup.controls.scheduled_rental_date) || addFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                      <ng-container
                        *ngTemplateOutlet="
                          labels;
                          context: { label: '貸出予定日', required: true }
                        ">
                      </ng-container>
                      <ng-container
                        *ngTemplateOutlet="
                          errors;
                          context: {
                            ctrl: addFc.scheduledDateGroup.controls
                              .scheduled_rental_date
                          }
                        "
                        message>
                      </ng-container>
                    </app-date-term>
                  </div>
                  <div class="w-1/2">
                    <app-date-term
                      nameAttrValue="scheduled_return_date"
                      idAttrValue="scheduled-return-date"
                      [formCtrl]="
                        addFc.scheduledDateGroup.controls.scheduled_return_date
                      "
                      [invalid]="formControlStateManager(addFc.scheduledDateGroup.controls.scheduled_return_date) || addFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                      <ng-container
                        *ngTemplateOutlet="
                          labels;
                          context: { label: '返却予定日', required: true }
                        ">
                      </ng-container>
                      <ng-container
                        *ngTemplateOutlet="
                          errors;
                          context: {
                            ctrl: addFc.scheduledDateGroup.controls
                              .scheduled_return_date
                          }
                        "
                        message>
                      </ng-container>
                    </app-date-term>
                  </div>
                </div>
                <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
                <ng-container
                  *ngTemplateOutlet="
                    dateErrors;
                    context: { ctrls: addFc.scheduledDateGroup }
                  "></ng-container>
              </div>
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="delivery_division_id"
                  idAttrValue="delivery-division-id"
                  [formCtrl]="addFc.delivery_division_id"
                  [options]="deliveryDivisionOptions"
                  [invalid]="
                    formControlStateManager(addFc.delivery_division_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '配送区分', required: 'true' }
                    "></ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { ctrl: addFc.delivery_division_id }
                    "
                    message></ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="collection_division_id"
                  idAttrValue="collection-division-id"
                  [formCtrl]="addFc.collection_division_id"
                  [options]="collectionDivisionOptions"
                  [invalid]="
                    formControlStateManager(addFc.collection_division_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '回収区分', required: 'true' }
                    "></ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { ctrl: addFc.collection_division_id }
                    "
                    message></ng-container>
                </app-select-container>
              </div>
            </div>
          </ng-container>
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-1/2">
              <app-textarea-container
                nameAttrValue="remarks_1"
                idAttrValue="remarks-1"
                [formCtrl]="addFc.remarks_1"
                [invalid]="formControlStateManager(addFc.remarks_1)">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: {
                      label: '備考1',
                      required: false
                    }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="errors; context: { ctrl: addFc.remarks_1 }"
                  message></ng-container>
              </app-textarea-container>
            </div>
            <div class="w-1/2">
              <app-textarea-container
                nameAttrValue="remarks_2"
                idAttrValue="remarks-2"
                [formCtrl]="addFc.remarks_2"
                [invalid]="formControlStateManager(addFc.remarks_2)">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: {
                      label: '備考2',
                      required: false
                    }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="errors; context: { ctrl: addFc.remarks_2 }"
                  message></ng-container>
              </app-textarea-container>
            </div>
          </div>
          <hr class="mt-4" />
          <div class="flex gap-6 justify-end mx-4 pb-2">
            <div class="pt-7">
              <app-button
                btnType="submit"
                btnFillColor="bg-success"
                btnHoverColor="hover:bg-success-hover"
                btnTextColor="text-white"
                btnLineColor="border-success"
                btnLineHoverColor="hover:border-success-hover"
                [buttonDisabled]="addForm.invalid || addForm.pristine">
                追加
              </app-button>
            </div>
            <div class="pt-7">
              <app-button (click)="addFormCancel()">キャンセル</app-button>
            </div>
          </div>
        </ng-container>
      </form>
    </div>
  </div>
</ng-template>

<!-- 編集フォームのテンプレート -->
<ng-template #edit>
  <div class="py-4 bg-slate-50 text-base">
    <div class="mx-4">
      <p class="mx-4 text-rose-500">
        <span class="border-b border-rose-500"
          >※
          料金は商品の売価・税率・税区分（内税または外税）から税込価格を計算し自動的に設定されます。</span
        >
      </p>
      <form class="mt-4" [formGroup]="editForm" autocomplete="off">
        <div class="mx-4 flex gap-6">
          <div class="w-3/4">
            <p>編集対象のレンタル商品</p>
            <ng-container *ngIf="editTargetProduct">
              <div class="flex gap-14">
                <p>商品名：{{ editTargetProduct.name }}</p>
                <p *ngIf="!selectedProductDeliveryChargeFlag">
                  レンタル料金：{{ editTargetProduct.selling_price }}（{{
                    editTargetProduct.division_sales_tax_value
                  }}）
                </p>
                <div style="display: none">
                  <app-text-container
                    nameAttrValue="rental_fee"
                    idAttrValue="rental-fee"
                    [formCtrl]="editFc.rental_fee"
                    [invalid]="formControlStateManager(editFc.rental_fee)">
                  </app-text-container>
                </div>
              </div>
            </ng-container>
          </div>
          <ng-container *ngIf="selectedProductDeliveryChargeFlag">
            <div class="w-1/4">
              <app-text-container
                nameAttrValue="delivery_price"
                idAttrValue="delivery-price"
                [textRight]="true"
                [formCtrl]="editFc.delivery_price"
                [invalid]="formControlStateManager(editFc.delivery_price)"
                style="display: hidden">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '配送料（税込）', required: false }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.delivery_price }
                  "
                  message></ng-container>
              </app-text-container>
            </div>
          </ng-container>
        </div>
        <ng-container *ngIf="!selectedProductDeliveryChargeFlag">
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-2/4">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_rental_date"
                    idAttrValue="scheduled-rental-date"
                    [formCtrl]="
                      editFc.scheduledDateGroup.controls.scheduled_rental_date
                    "
                    [invalid]="formControlStateManager(editFc.scheduledDateGroup.controls.scheduled_rental_date) || editFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.scheduledDateGroup.controls
                            .scheduled_rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_return_date"
                    idAttrValue="scheduled-return-date"
                    [formCtrl]="
                      editFc.scheduledDateGroup.controls.scheduled_return_date
                    "
                    [invalid]="formControlStateManager(editFc.scheduledDateGroup.controls.scheduled_return_date) || editFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '返却予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.scheduledDateGroup.controls
                            .scheduled_return_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: editFc.scheduledDateGroup }
                "></ng-container>
            </div>
            <div class="w-2/4">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="rental_date"
                    idAttrValue="rental-date"
                    [formCtrl]="editFc.dateGroup.controls.rental_date"
                    [invalid]="formControlStateManager(editFc.dateGroup.controls.rental_date) || editFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出日(指定)', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.dateGroup.controls.rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="return_date"
                    idAttrValue="return-date"
                    [formCtrl]="editFc.dateGroup.controls.return_date"
                    [invalid]="formControlStateManager(editFc.dateGroup.controls.return_date) || editFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '返却日(指定)', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.dateGroup.controls.return_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: editFc.dateGroup }
                "></ng-container>
            </div>
          </div>
          <div class="mt-4 mx-4 flex gap-6">
            <ng-container *ngIf="!rentalItemStatus">
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="editFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4 flex">
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-1/3"
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
                <div class="w-2/3 mt-6">
                  <app-button
                    class="ml-2 mr-2"
                    btnType="button"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    [buttonDisabled]="detailUnitdisabledRentalTodayButton()"
                    (click)="sRentalToday()"
                    >貸出（当日）</app-button
                  >
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="rentalItemStatus">
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="editFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4">
                <!-- idで社員を取得する -->
                <app-text-container
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="return_employee_id"
                  idAttrValue="return-employee-id"
                  [formCtrl]="editFc.return_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.return_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '返却担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.return_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4 flex">
                <ng-container
                  *ngIf="!boolean_return_date && boolean_rental_date">
                  <!-- idで社員を取得する -->
                  <app-text-container
                    class="w-2/5"
                    nameAttrValue="get_return_employee_id"
                    idAttrValue="get-return-employee-id"
                    [formCtrl]="getEmployeeByIdFcReturn.get_return_employee_id"
                    [invalid]="
                      formControlStateManager(
                        getEmployeeByIdFcReturn.get_return_employee_id
                      )
                    ">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '社員IDで選択', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          fc: getEmployeeByIdFcReturn.get_return_employee_id
                        }
                      "
                      message>
                    </ng-container>
                  </app-text-container>
                  <div class="w-3/5 mt-6">
                    <app-button
                      class="ml-2 mr-2"
                      btnType="button"
                      btnFillColor="bg-success"
                      btnHoverColor="hover:bg-success-hover"
                      btnTextColor="text-white"
                      btnLineColor="border-success"
                      btnLineHoverColor="hover:border-success-hover"
                      [buttonDisabled]="!this.editFc.return_employee_id.value"
                      (click)="sReturnToday()"
                      >返却(当日)</app-button
                    >
                  </div>
                </ng-container>
                <ng-container
                  *ngIf="boolean_return_date && !boolean_rental_date">
                  <!-- idで社員を取得する -->
                  <app-text-container
                    class="w-full"
                    nameAttrValue="get_return_employee_id"
                    idAttrValue="get-return-employee-id"
                    [formCtrl]="getEmployeeByIdFcReturn.get_return_employee_id"
                    [invalid]="
                      formControlStateManager(
                        getEmployeeByIdFcReturn.get_return_employee_id
                      )
                    ">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '社員IDで選択', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          fc: getEmployeeByIdFcReturn.get_return_employee_id
                        }
                      "
                      message>
                    </ng-container>
                  </app-text-container>
                </ng-container>
              </div>
            </ng-container>
          </div>
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="delivery_division_id"
                idAttrValue="delivery-division-id"
                [formCtrl]="editFc.delivery_division_id"
                [options]="deliveryDivisionOptions"
                [invalid]="
                  formControlStateManager(editFc.delivery_division_id)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '配送区分', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.delivery_division_id }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="collection_division_id"
                idAttrValue="collection-division-id"
                [formCtrl]="editFc.collection_division_id"
                [options]="collectionDivisionOptions"
                [invalid]="
                  formControlStateManager(editFc.collection_division_id)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '回収区分', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.collection_division_id }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="late_return_reported"
                idAttrValue="late-return-reported"
                [formCtrl]="editFc.late_return_reported"
                [options]="lateReturnReportedOptions"
                [invalid]="
                  formControlStateManager(editFc.late_return_reported)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '延滞報告', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.late_return_reported }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
          </div>
        </ng-container>
        <div class="mt-4 mx-4 flex gap-6">
          <div class="w-1/2">
            <app-textarea-container
              nameAttrValue="remarks_1"
              idAttrValue="remarks-1"
              [formCtrl]="editFc.remarks_1"
              [invalid]="formControlStateManager(editFc.remarks_1)">
              <ng-container
                *ngTemplateOutlet="
                  labels;
                  context: {
                    label: '備考1',
                    required: false
                  }
                "></ng-container>
              <ng-container
                *ngTemplateOutlet="errors; context: { ctrl: editFc.remarks_1 }"
                message></ng-container>
            </app-textarea-container>
          </div>
          <div class="w-1/2">
            <app-textarea-container
              nameAttrValue="remarks_2"
              idAttrValue="remarks-2"
              [formCtrl]="editFc.remarks_2"
              [invalid]="formControlStateManager(editFc.remarks_2)">
              <ng-container
                *ngTemplateOutlet="
                  labels;
                  context: {
                    label: '備考2',
                    required: false
                  }
                "></ng-container>
              <ng-container
                *ngTemplateOutlet="errors; context: { ctrl: editFc.remarks_2 }"
                message></ng-container>
            </app-textarea-container>
          </div>
        </div>
        <hr class="mt-4" />
        <div class="flex gap-6 justify-end mx-4 pb-2">
          <div class="pt-7">
            <ng-container *ngIf="!rentalItemStatus">
              <app-button
                btnType="submit"
                btnFillColor="bg-success"
                btnHoverColor="hover:bg-success-hover"
                btnTextColor="text-white"
                btnLineColor="border-success"
                btnLineHoverColor="hover:border-success-hover"
                (click)="RentalSaveButton()"
                [buttonDisabled]="detailUnitdisabledRentalSaveButton()">
                保存
              </app-button>
            </ng-container>
            <ng-container *ngIf="boolean_rental_date">
              <app-button
                btnType="submit"
                btnFillColor="bg-success"
                btnHoverColor="hover:bg-success-hover"
                btnTextColor="text-white"
                btnLineColor="border-success"
                btnLineHoverColor="hover:border-success-hover"
                (click)="RentalEditExecutionButton()"
                [buttonDisabled]="detailUnitdisabledReturnSaveButton()">
                保存
              </app-button>
            </ng-container>
          </div>
          <div class="pt-7">
            <app-button (click)="editFormCancel()">キャンセル</app-button>
          </div>
        </div>
      </form>
    </div>
  </div>
</ng-template>

<!-- 滞納フォームのテンプレート -->
<ng-template #receipt>
  <div class="py-4 bg-slate-50 text-base">
    <div class="mx-4">
      <p class="mx-4 text-rose-500">
        <span class="border-b border-rose-500"
          >※
          料金は商品の売価・税率・税区分（内税または外税）から税込価格を計算し自動的に設定されます。【滞納・返金フォーム】</span
        >
      </p>
      <form
        class="mt-4"
        [formGroup]="editForm"
        (ngSubmit)="handleClickRentalDiffExecutionButton('')"
        autocomplete="off">
        <div class="mx-4 flex gap-6">
          <div class="w-3/4">
            <p>編集対象のレンタル商品</p>
            <ng-container *ngIf="editTargetProduct">
              <div class="flex gap-14">
                <p>商品名：{{ editTargetProduct.name }}</p>
                <p *ngIf="!selectedProductDeliveryChargeFlag">
                  レンタル料金：{{ editTargetProduct.selling_price }}（{{
                    editTargetProduct.division_sales_tax_value
                  }}）
                </p>
                <div style="display: none">
                  <app-text-container
                    nameAttrValue="rental_fee"
                    idAttrValue="rental-fee"
                    [formCtrl]="editFc.rental_fee"
                    [invalid]="formControlStateManager(editFc.rental_fee)">
                  </app-text-container>
                </div>
              </div>
            </ng-container>
          </div>
          <ng-container *ngIf="selectedProductDeliveryChargeFlag">
            <div class="w-1/4">
              <app-text-container
                nameAttrValue="delivery_price"
                idAttrValue="delivery-price"
                [textRight]="true"
                [formCtrl]="editFc.delivery_price"
                [invalid]="formControlStateManager(editFc.delivery_price)"
                style="display: hidden">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '配送料（税込）', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.delivery_price }
                  "
                  message></ng-container>
              </app-text-container>
            </div>
          </ng-container>
        </div>
        <ng-container *ngIf="!selectedProductDeliveryChargeFlag">
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-2/4">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_rental_date"
                    idAttrValue="scheduled-rental-date"
                    [formCtrl]="
                      editFc.scheduledDateGroup.controls.scheduled_rental_date
                    "
                    [invalid]="formControlStateManager(editFc.scheduledDateGroup.controls.scheduled_rental_date) || editFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.scheduledDateGroup.controls
                            .scheduled_rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="scheduled_return_date"
                    idAttrValue="scheduled-return-date"
                    [formCtrl]="
                      editFc.scheduledDateGroup.controls.scheduled_return_date
                    "
                    [invalid]="formControlStateManager(editFc.scheduledDateGroup.controls.scheduled_return_date) || editFc.scheduledDateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '返却予定日', required: true }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.scheduledDateGroup.controls
                            .scheduled_return_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: editFc.scheduledDateGroup }
                "></ng-container>
            </div>
            <div class="w-2/4">
              <div class="flex gap-6">
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="rental_date"
                    idAttrValue="rental-date"
                    [formCtrl]="editFc.dateGroup.controls.rental_date"
                    [invalid]="formControlStateManager(editFc.dateGroup.controls.rental_date) || editFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '貸出日(指定)', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.dateGroup.controls.rental_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
                <div class="w-1/2">
                  <app-date-term
                    nameAttrValue="return_date"
                    idAttrValue="return-date"
                    [formCtrl]="editFc.dateGroup.controls.return_date"
                    [invalid]="formControlStateManager(editFc.dateGroup.controls.return_date) || editFc.dateGroup.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '受領・返金日', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          ctrl: editFc.dateGroup.controls.return_date
                        }
                      "
                      message>
                    </ng-container>
                  </app-date-term>
                </div>
              </div>
              <!-- 日付選択エラーの表示位置調整のためこの場所に設置 -->
              <ng-container
                *ngTemplateOutlet="
                  dateErrors;
                  context: { ctrls: editFc.dateGroup }
                "></ng-container>
            </div>
          </div>
          <div class="mt-4 mx-4 flex gap-6">
            <ng-container *ngIf="!rentalItemStatus">
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="editFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4 flex">
                <!-- idで社員を取得する -->
                <app-text-container
                  class="w-1/3"
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
                <div class="w-2/3 mt-6">
                  <app-button
                    class="ml-2 mr-2"
                    btnType="button"
                    btnFillColor="bg-success"
                    btnHoverColor="hover:bg-success-hover"
                    btnTextColor="text-white"
                    btnLineColor="border-success"
                    btnLineHoverColor="hover:border-success-hover"
                    (click)="sRentalToday()"
                    >貸出（当日）</app-button
                  >
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="rentalItemStatus">
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="rental_employee_id"
                  idAttrValue="rental-employee-id"
                  [formCtrl]="editFc.rental_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.rental_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '貸出担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.rental_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4">
                <!-- idで社員を取得する -->
                <app-text-container
                  nameAttrValue="get_rental_employee_id"
                  idAttrValue="get-rental-employee-id"
                  [formCtrl]="getEmployeeByIdFcRental.get_rental_employee_id"
                  [invalid]="
                    formControlStateManager(
                      getEmployeeByIdFcRental.get_rental_employee_id
                    )
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '社員IDで選択', required: false }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: {
                        fc: getEmployeeByIdFcRental.get_rental_employee_id
                      }
                    "
                    message>
                  </ng-container>
                </app-text-container>
              </div>
              <div class="w-1/4">
                <app-select-container
                  nameAttrValue="return_employee_id"
                  idAttrValue="return-employee-id"
                  [formCtrl]="editFc.return_employee_id"
                  [options]="employeeSuggests"
                  [invalid]="
                    formControlStateManager(editFc.return_employee_id)
                  ">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '返却担当者', required: true }
                    ">
                  </ng-container>
                  <ng-container
                    *ngTemplateOutlet="
                      errors;
                      context: { fc: editFc.return_employee_id }
                    "
                    message>
                  </ng-container>
                </app-select-container>
              </div>
              <div class="w-1/4 flex">
                <ng-container *ngIf="!boolean_receipt_date">
                  <!-- idで社員を取得する -->
                  <app-text-container
                    class="w-2/5"
                    nameAttrValue="get_return_employee_id"
                    idAttrValue="get-return-employee-id"
                    [formCtrl]="getEmployeeByIdFcReturn.get_return_employee_id"
                    [invalid]="
                      formControlStateManager(
                        getEmployeeByIdFcReturn.get_return_employee_id
                      )
                    ">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '社員IDで選択', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          fc: getEmployeeByIdFcReturn.get_return_employee_id
                        }
                      "
                      message>
                    </ng-container>
                  </app-text-container>
                  <div class="w-3/5 mt-6">
                    <app-button
                      class="ml-2 mr-2"
                      btnType="button"
                      btnFillColor="bg-success"
                      btnHoverColor="hover:bg-success-hover"
                      btnTextColor="text-white"
                      btnLineColor="border-success"
                      btnLineHoverColor="hover:border-success-hover"
                      (click)="sDiffReturnToday()"
                      >受領・返金日(当日)</app-button
                    >
                  </div>
                </ng-container>
                <ng-container *ngIf="boolean_receipt_date">
                  <!-- idで社員を取得する -->
                  <app-text-container
                    class="w-full"
                    nameAttrValue="get_return_employee_id"
                    idAttrValue="get-return-employee-id"
                    [formCtrl]="getEmployeeByIdFcReturn.get_return_employee_id"
                    [invalid]="
                      formControlStateManager(
                        getEmployeeByIdFcReturn.get_return_employee_id
                      )
                    ">
                    <ng-container
                      *ngTemplateOutlet="
                        labels;
                        context: { label: '社員IDで選択', required: false }
                      ">
                    </ng-container>
                    <ng-container
                      *ngTemplateOutlet="
                        errors;
                        context: {
                          fc: getEmployeeByIdFcReturn.get_return_employee_id
                        }
                      "
                      message>
                    </ng-container>
                  </app-text-container>
                </ng-container>
              </div>
            </ng-container>
          </div>
          <div class="mt-4 mx-4 flex gap-6">
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="delivery_division_id"
                idAttrValue="delivery-division-id"
                [formCtrl]="editFc.delivery_division_id"
                [options]="deliveryDivisionOptions"
                [invalid]="
                  formControlStateManager(editFc.delivery_division_id)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '配送区分', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.delivery_division_id }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="collection_division_id"
                idAttrValue="collection-division-id"
                [formCtrl]="editFc.collection_division_id"
                [options]="collectionDivisionOptions"
                [invalid]="
                  formControlStateManager(editFc.collection_division_id)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '回収区分', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.collection_division_id }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
            <div class="w-1/4">
              <app-select-container
                nameAttrValue="late_return_reported"
                idAttrValue="late-return-reported"
                [formCtrl]="editFc.late_return_reported"
                [options]="lateReturnReportedOptions"
                [invalid]="
                  formControlStateManager(editFc.late_return_reported)
                ">
                <ng-container
                  *ngTemplateOutlet="
                    labels;
                    context: { label: '延滞報告', required: 'true' }
                  "></ng-container>
                <ng-container
                  *ngTemplateOutlet="
                    errors;
                    context: { ctrl: editFc.late_return_reported }
                  "
                  message></ng-container>
              </app-select-container>
            </div>
            <div class="w-1/4">
              <ng-container
                *ngIf="overdue_rentals_ad_status[0] === DIFF_STAUS_DETENTION">
                <app-text-container
                  nameAttrValue="late_fee"
                  idAttrValue="late-fee"
                  [formCtrl]="editFc.late_fee"
                  [invalid]="formControlStateManager(editFc.late_fee)">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '差額(延滞)', required: 'false' }
                    "></ng-container>
                </app-text-container>
              </ng-container>
              <ng-container
                *ngIf="overdue_rentals_ad_status[0] === DIFF_STAUS_REFUND">
                <app-text-container
                  nameAttrValue="refund_fee"
                  idAttrValue="refund-fee"
                  [formCtrl]="editFc.refund_fee"
                  [invalid]="formControlStateManager(editFc.refund_fee)">
                  <ng-container
                    *ngTemplateOutlet="
                      labels;
                      context: { label: '差額(払戻)', required: 'false' }
                    "></ng-container>
                </app-text-container>
              </ng-container>
            </div>
          </div>
        </ng-container>
        <div class="mt-4 mx-4 flex gap-6">
          <div class="w-1/2">
            <app-textarea-container
              nameAttrValue="remarks_1"
              idAttrValue="remarks-1"
              [formCtrl]="editFc.remarks_1"
              [invalid]="formControlStateManager(editFc.remarks_1)">
              <ng-container
                *ngTemplateOutlet="
                  labels;
                  context: {
                    label: '備考1',
                    required: false
                  }
                "></ng-container>
              <ng-container
                *ngTemplateOutlet="errors; context: { ctrl: editFc.remarks_1 }"
                message></ng-container>
            </app-textarea-container>
          </div>
          <div class="w-1/2">
            <app-textarea-container
              nameAttrValue="remarks_2"
              idAttrValue="remarks-2"
              [formCtrl]="editFc.remarks_2"
              [invalid]="formControlStateManager(editFc.remarks_2)">
              <ng-container
                *ngTemplateOutlet="
                  labels;
                  context: {
                    label: '備考2',
                    required: false
                  }
                "></ng-container>
              <ng-container
                *ngTemplateOutlet="errors; context: { ctrl: editFc.remarks_2 }"
                message></ng-container>
            </app-textarea-container>
          </div>
        </div>
        <hr class="mt-4" />
        <div class="flex gap-6 justify-end mx-4 pb-2">
          <div class="pt-7">
            <app-button
              btnType="submit"
              btnFillColor="bg-success"
              btnHoverColor="hover:bg-success-hover"
              btnTextColor="text-white"
              btnLineColor="border-success"
              btnLineHoverColor="hover:border-success-hover"
              [buttonDisabled]="editForm.invalid || editForm.pristine">
              保存
            </app-button>
          </div>
          <div class="pt-7">
            <app-button (click)="editFormCancel()">キャンセル</app-button>
          </div>
        </div>
      </form>
    </div>
  </div>
</ng-template>

<!-- ↓ app-text-container に渡すコンテンツのテンプレート ↓ -->
<ng-template #labels let-label="label" let-required="required">
  <div class="flex items-center gap-2">
    <span class="text-sm">{{ label }}</span>
    <span
      *ngIf="required"
      class="px-3 py-0.5 text-xs text-white bg-warning-dark rounded-full"
      >必須</span
    >
  </div>
</ng-template>

<!-- ↓ 必須エラーメッセージのテンプレート ↓ -->
<ng-template #errors let-ctrl="ctrl">
  <ng-container *ngIf="formControlStateManager(ctrl)">
    <p class="mt-1 pl-1 text-sm text-red" *ngIf="ctrl.errors?.['required']">
      {{ errorConst.FORM_ERROR.REQUIRED_ITEM }}
    </p>
  </ng-container>
</ng-template>

<!-- ↓ 最小値エラーメッセージのテンプレート ↓ -->
<ng-template #minErrors let-ctrl="ctrl">
  <ng-container *ngIf="formControlStateManager(ctrl)">
    <p class="mt-1 pl-1 text-sm text-red" *ngIf="ctrl.errors?.['min']">
      {{ errorConst.FORM_ERROR.EXCEEDED_CHARACTER_MIN_LIMIT }}
    </p>
  </ng-container>
</ng-template>

<!-- ↓ 日付指定エラーメッセージのテンプレート ↓ -->
<ng-template #dateErrors let-ctrls="ctrls">
  <ng-container
    *ngIf="ctrls.errors?.['isStartDateGreaterThanOrEqualToEndDate']">
    <p class="mt-1 pl-1 text-sm text-red">
      {{ errorConst.FORM_ERROR.DATE_SPECIFICATION_VIOLATION }}
    </p>
  </ng-container>
</ng-template>
